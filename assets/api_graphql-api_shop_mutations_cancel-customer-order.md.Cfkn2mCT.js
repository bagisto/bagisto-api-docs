import{_ as a,a as i,o as e,ai as n}from"./chunks/framework.BbOtTPsL.js";const k=JSON.parse('{"title":"Cancel Customer Order","description":"","frontmatter":{"outline":false,"examples":[{"id":"cancel-customer-order-success","title":"Cancel a Pending Customer Order","description":"Cancel a customer order that is in pending status, restoring inventory to stock.","query":"mutation {\\n  createCancelOrder(input: { orderId: 2 }) {\\n    cancelOrder {\\n      success\\n      message\\n      orderId\\n      status\\n    }\\n  }\\n}\\n","variables":"{}\\n","response":"{\\n  \\"data\\": {\\n    \\"createCancelOrder\\": {\\n      \\"cancelOrder\\": {\\n        \\"success\\": true,\\n        \\"message\\": \\"Order has been canceled successfully\\",\\n        \\"orderId\\": 2,\\n        \\"status\\": \\"canceled\\"\\n      }\\n    }\\n  }\\n}\\n","commonErrors":[{"error":"UNAUTHENTICATED","cause":"Missing or invalid Bearer token","solution":"Login and provide a valid customer authentication token"},{"error":"NOT_FOUND","cause":"Order with specified ID does not exist or does not belong to the customer","solution":"Verify the order ID and ensure it belongs to the authenticated customer"},{"error":"CANNOT_CANCEL","cause":"Order cannot be canceled (already completed, shipped, or canceled)","solution":"Check order status - only pending orders can be canceled"}]},{"id":"cancel-customer-order-blocked","title":"Cancel Order - Already Canceled (Error)","description":"Attempt to cancel an order that is already canceled (should fail).","query":"mutation {\\n  createCancelOrder(input: { orderId: 2 }) {\\n    cancelOrder {\\n      success\\n      message\\n      orderId\\n      status\\n    }\\n  }\\n}\\n","variables":"{}\\n","response":"{\\n  \\"data\\": {\\n    \\"createCancelOrder\\": {\\n      \\"cancelOrder\\": {\\n        \\"success\\": false,\\n        \\"message\\": \\"Order cannot be canceled. It may have already been processed, shipped, or canceled\\",\\n        \\"orderId\\": 2,\\n        \\"status\\": \\"canceled\\"\\n      }\\n    }\\n  }\\n}\\n","commonErrors":[{"error":"CANCEL_NOT_ALLOWED","cause":"Order status does not allow cancellation","solution":"Only orders with pending status can be canceled"}]}]},"headers":[],"relativePath":"api/graphql-api/shop/mutations/cancel-customer-order.md","filePath":"api/graphql-api/shop/mutations/cancel-customer-order.md","lastUpdated":1771606128000}'),t={name:"api/graphql-api/shop/mutations/cancel-customer-order.md"};function l(r,s,h,p,o,d){return e(),i("div",null,s[0]||(s[0]=[n(`<h1 id="cancel-customer-order" tabindex="-1">Cancel Customer Order <a class="header-anchor" href="#cancel-customer-order" aria-label="Permalink to &quot;Cancel Customer Order&quot;">​</a></h1><h2 id="overview" tabindex="-1">Overview <a class="header-anchor" href="#overview" aria-label="Permalink to &quot;Overview&quot;">​</a></h2><p>The Cancel Order API allows authenticated customers to cancel their pending orders. This mutation validates order ownership, checks cancellation eligibility, and reverses inventory allocation when successful.</p><h2 id="endpoint" tabindex="-1">Endpoint <a class="header-anchor" href="#endpoint" aria-label="Permalink to &quot;Endpoint&quot;">​</a></h2><p><strong>GraphQL Mutation URL</strong>: <code>POST /api/graphql</code></p><h2 id="authentication" tabindex="-1">Authentication <a class="header-anchor" href="#authentication" aria-label="Permalink to &quot;Authentication&quot;">​</a></h2><p><strong>Required</strong>: Bearer Token (Sanctum)<br><strong>Scope</strong>: Customer only (order must belong to authenticated customer)</p><h2 id="request" tabindex="-1">Request <a class="header-anchor" href="#request" aria-label="Permalink to &quot;Request&quot;">​</a></h2><h3 id="graphql-mutation-schema" tabindex="-1">GraphQL Mutation Schema <a class="header-anchor" href="#graphql-mutation-schema" aria-label="Permalink to &quot;GraphQL Mutation Schema&quot;">​</a></h3><div class="language-graphql vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">graphql</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">mutation</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> CreateCancelOrder</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">$input</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">CancelOrderInput</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">!</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">  createCancelOrder</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">input</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">$input</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">    cancelOrder</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">      success</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">      # Boolean: true if cancel succeeded</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">      message</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">      # String: response message</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">      orderId</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">      # Int: the order ID</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">      status</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">       # String: final order status</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><h3 id="input-parameters" tabindex="-1">Input Parameters <a class="header-anchor" href="#input-parameters" aria-label="Permalink to &quot;Input Parameters&quot;">​</a></h3><table tabindex="0"><thead><tr><th>Parameter</th><th>Type</th><th>Required</th><th>Description</th></tr></thead><tbody><tr><td><code>orderId</code></td><td>Integer</td><td>Yes</td><td>The numeric ID of the order to cancel</td></tr></tbody></table><h2 id="response" tabindex="-1">Response <a class="header-anchor" href="#response" aria-label="Permalink to &quot;Response&quot;">​</a></h2><h3 id="success-response-200-ok" tabindex="-1">Success Response (200 OK) <a class="header-anchor" href="#success-response-200-ok" aria-label="Permalink to &quot;Success Response (200 OK)&quot;">​</a></h3><div class="language-json vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">json</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  &quot;data&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: {</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    &quot;createCancelOrder&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: {</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">      &quot;cancelOrder&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: {</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">        &quot;success&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">true</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">        &quot;message&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;Order has been canceled successfully&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">        &quot;orderId&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">2</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">        &quot;status&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;canceled&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><h3 id="failure-response-cannot-cancel" tabindex="-1">Failure Response - Cannot Cancel <a class="header-anchor" href="#failure-response-cannot-cancel" aria-label="Permalink to &quot;Failure Response - Cannot Cancel&quot;">​</a></h3><p>When order cannot be canceled (already canceled, shipped, or completed):</p><div class="language-json vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">json</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  &quot;data&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: {</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    &quot;createCancelOrder&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: {</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">      &quot;cancelOrder&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: {</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">        &quot;success&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">false</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">        &quot;message&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;Order cannot be canceled. It may have already been processed, shipped, or canceled&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">        &quot;orderId&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">2</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">        &quot;status&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;canceled&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><h3 id="error-response-unauthorized-401" tabindex="-1">Error Response - Unauthorized (401) <a class="header-anchor" href="#error-response-unauthorized-401" aria-label="Permalink to &quot;Error Response - Unauthorized (401)&quot;">​</a></h3><div class="language-json vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">json</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  &quot;errors&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: [</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    {</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">      &quot;message&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;Unauthenticated&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">      &quot;extensions&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: {</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">        &quot;code&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;UNAUTHENTICATED&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  ]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><h3 id="error-response-order-not-found-404" tabindex="-1">Error Response - Order Not Found (404) <a class="header-anchor" href="#error-response-order-not-found-404" aria-label="Permalink to &quot;Error Response - Order Not Found (404)&quot;">​</a></h3><p>When order ID doesn&#39;t exist or belongs to a different customer:</p><div class="language-json vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">json</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  &quot;data&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: {</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    &quot;createCancelOrder&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">null</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><h2 id="business-logic" tabindex="-1">Business Logic <a class="header-anchor" href="#business-logic" aria-label="Permalink to &quot;Business Logic&quot;">​</a></h2><h3 id="cancellation-eligibility" tabindex="-1">Cancellation Eligibility <a class="header-anchor" href="#cancellation-eligibility" aria-label="Permalink to &quot;Cancellation Eligibility&quot;">​</a></h3><p>An order can be canceled if:</p><ul><li>Order status is <code>pending</code> (not shipped, completed, or already canceled)</li><li>Order belongs to the authenticated customer</li><li>Order is not a composite/grouped order (or all child items are cancelable)</li></ul><h3 id="when-cancellation-succeeds" tabindex="-1">When Cancellation Succeeds <a class="header-anchor" href="#when-cancellation-succeeds" aria-label="Permalink to &quot;When Cancellation Succeeds&quot;">​</a></h3><ol><li><strong>Order Status</strong>: Changed from <code>pending</code> → <code>canceled</code></li><li><strong>Inventory</strong>: All ordered items are returned to stock</li><li><strong>Qty Canceled</strong>: Updated to match ordered quantity for all items</li><li><strong>Events Fired</strong>: <ul><li><code>order.cancel.before</code> — before cancel operations</li><li><code>order.cancel.after</code> — after successful cancellation</li></ul></li><li><strong>Database</strong>: Order and item records updated atomically</li></ol><h3 id="when-cancellation-fails" tabindex="-1">When Cancellation Fails <a class="header-anchor" href="#when-cancellation-fails" aria-label="Permalink to &quot;When Cancellation Fails&quot;">​</a></h3><ul><li>Order status remains unchanged</li><li>No inventory is returned</li><li>Appropriate error message returned</li></ul><h2 id="state-transitions" tabindex="-1">State Transitions <a class="header-anchor" href="#state-transitions" aria-label="Permalink to &quot;State Transitions&quot;">​</a></h2><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>pending → canceled (valid)</span></span>
<span class="line"><span>shipped → (cannot cancel)</span></span>
<span class="line"><span>completed → (cannot cancel)</span></span>
<span class="line"><span>canceled → (cannot re-cancel)</span></span></code></pre></div><h2 id="use-cases" tabindex="-1">Use Cases <a class="header-anchor" href="#use-cases" aria-label="Permalink to &quot;Use Cases&quot;">​</a></h2><ul><li>Cancel unwanted orders before processing</li><li>Allow customers to self-service cancel pending orders</li><li>Automatically restore inventory when customers cancel</li><li>Reduce support requests by enabling customer-driven cancellation</li><li>Workflow: Customer views order → clicks cancel → inventory restored</li></ul><h2 id="testing-examples" tabindex="-1">Testing Examples <a class="header-anchor" href="#testing-examples" aria-label="Permalink to &quot;Testing Examples&quot;">​</a></h2><h3 id="test-case-1-cancel-pending-order-success" tabindex="-1">Test Case 1: Cancel Pending Order (Success) <a class="header-anchor" href="#test-case-1-cancel-pending-order-success" aria-label="Permalink to &quot;Test Case 1: Cancel Pending Order (Success)&quot;">​</a></h3><p><strong>Precondition</strong>: Order #2 with status <code>pending</code> exists for customer #2</p><p><strong>Query</strong>:</p><div class="language-graphql vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">graphql</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">mutation</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">  createCancelOrder</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">input</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: { </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">orderId</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">2</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> }) {</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">    cancelOrder</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">      success</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">      message</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">      orderId</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">      status</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><p><strong>Expected Result</strong>:</p><div class="language-json vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">json</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  &quot;success&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">true</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  &quot;message&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;Order has been canceled successfully&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  &quot;orderId&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">2</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  &quot;status&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;canceled&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><p><strong>Database Verification</strong>:</p><div class="language-sql vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">SELECT</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> id, </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">status</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> FROM</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> orders </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">WHERE</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> id </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 2</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">-- Result: id=2, status=&#39;canceled&#39;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">SELECT</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> order_id, qty_ordered, qty_canceled </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">FROM</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> order_items </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">WHERE</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> order_id </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 2</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">-- Result: qty_canceled should equal qty_ordered for all items</span></span></code></pre></div><h3 id="test-case-2-re-cancel-already-canceled-order-failure" tabindex="-1">Test Case 2: Re-Cancel Already Canceled Order (Failure) <a class="header-anchor" href="#test-case-2-re-cancel-already-canceled-order-failure" aria-label="Permalink to &quot;Test Case 2: Re-Cancel Already Canceled Order (Failure)&quot;">​</a></h3><p><strong>Precondition</strong>: Order #2 with status <code>canceled</code> (from Test Case 1)</p><p><strong>Query</strong>:</p><div class="language-graphql vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">graphql</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">mutation</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">  createCancelOrder</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">input</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: { </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">orderId</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">2</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> }) {</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">    cancelOrder</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">      success</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">      message</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">      orderId</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">      status</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><p><strong>Expected Result</strong>:</p><div class="language-json vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">json</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  &quot;success&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">false</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  &quot;message&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;Order cannot be canceled. It may have already been processed, shipped, or canceled&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  &quot;orderId&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">2</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  &quot;status&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;canceled&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><p><strong>No Database Changes</strong>: Order remains in <code>canceled</code> status</p><h3 id="test-case-3-cancel-without-authentication-failure" tabindex="-1">Test Case 3: Cancel Without Authentication (Failure) <a class="header-anchor" href="#test-case-3-cancel-without-authentication-failure" aria-label="Permalink to &quot;Test Case 3: Cancel Without Authentication (Failure)&quot;">​</a></h3><p><strong>Query</strong> (without Authorization header):</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">curl</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -X</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> POST</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> http://127.0.0.1:8000/api/graphql</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> \\</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  -H</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;Content-Type: application/json&quot;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> \\</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  -H</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;X-STOREFRONT-KEY: pk_storefront_qrr4vsdbs6xNpL7DN0GHUcB0XnhjnjIS&quot;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> \\</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  -d</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;{&quot;query&quot;:&quot;mutation { createCancelOrder(input: { orderId: 2 }) { cancelOrder { success message } } }&quot;}&#39;</span></span></code></pre></div><p><strong>Expected Result</strong>:</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>HTTP 401 Unauthorized</span></span>
<span class="line"><span>{</span></span>
<span class="line"><span>  &quot;errors&quot;: [</span></span>
<span class="line"><span>    {</span></span>
<span class="line"><span>      &quot;message&quot;: &quot;Unauthenticated&quot;,</span></span>
<span class="line"><span>      &quot;extensions&quot;: {&quot;code&quot;: &quot;UNAUTHENTICATED&quot;}</span></span>
<span class="line"><span>    }</span></span>
<span class="line"><span>  ]</span></span>
<span class="line"><span>}</span></span></code></pre></div><h2 id="implementation-details" tabindex="-1">Implementation Details <a class="header-anchor" href="#implementation-details" aria-label="Permalink to &quot;Implementation Details&quot;">​</a></h2><h3 id="files-involved" tabindex="-1">Files Involved <a class="header-anchor" href="#files-involved" aria-label="Permalink to &quot;Files Involved&quot;">​</a></h3><table tabindex="0"><thead><tr><th>File</th><th>Purpose</th></tr></thead><tbody><tr><td><code>CancelOrderInput.php</code></td><td>Input DTO with orderId parameter</td></tr><tr><td><code>CancelOrderProcessor.php</code></td><td>Handles mutation business logic</td></tr><tr><td><code>CancelOrder.php</code></td><td>Response model with success/message/orderId/status</td></tr></tbody></table><h3 id="key-components" tabindex="-1">Key Components <a class="header-anchor" href="#key-components" aria-label="Permalink to &quot;Key Components&quot;">​</a></h3><p><strong>CancelOrderProcessor</strong>:</p><ul><li>Authenticates request via <code>Auth::guard(&#39;sanctum&#39;)</code></li><li>Scopes orders to authenticated customer only</li><li>Delegates to <code>OrderRepository::cancel()</code> for business logic</li><li>Returns <code>CancelOrder</code> response model</li></ul><p><strong>OrderRepository::cancel()</strong>:</p><ul><li>Validates <code>$order-&gt;canCancel()</code> method</li><li>Fires <code>order.cancel.before</code> event</li><li>Iterates order items and returns inventory</li><li>Updates <code>qty_canceled</code> for each item</li><li>Calls <code>updateOrderStatus(&#39;canceled&#39;)</code></li><li>Fires <code>order.cancel.after</code> event</li></ul><h2 id="http-status-codes" tabindex="-1">HTTP Status Codes <a class="header-anchor" href="#http-status-codes" aria-label="Permalink to &quot;HTTP Status Codes&quot;">​</a></h2><table tabindex="0"><thead><tr><th>Code</th><th>Scenario</th></tr></thead><tbody><tr><td>200</td><td>Mutation executed (check <code>success</code> field for actual result)</td></tr><tr><td>400</td><td>Invalid request (missing storefront key, malformed query)</td></tr><tr><td>401</td><td>Unauthorized (missing or invalid Bearer token)</td></tr><tr><td>422</td><td>Validation error (invalid orderId type)</td></tr></tbody></table><h2 id="rate-limiting" tabindex="-1">Rate Limiting <a class="header-anchor" href="#rate-limiting" aria-label="Permalink to &quot;Rate Limiting&quot;">​</a></h2><p>No specific rate limiting for cancel mutations. General API rate limits apply per storefront key.</p><h2 id="notes" tabindex="-1">Notes <a class="header-anchor" href="#notes" aria-label="Permalink to &quot;Notes&quot;">​</a></h2><ul><li><strong>Customer isolation</strong>: Orders are scoped to the authenticated customer. A customer cannot cancel another customer&#39;s order.</li><li><strong>Inventory restoration</strong>: When an order is canceled, all items are returned to inventory automatically.</li><li><strong>Status tracking</strong>: The operation is governed by Bagisto&#39;s order cancellation rules and configuration.</li><li><strong>Event hooks</strong>: Extensions can listen to <code>order.cancel.before</code> and <code>order.cancel.after</code> events.</li><li><strong>Localization</strong>: All messages are localized to the customer&#39;s language.</li></ul><h2 id="related-resources" tabindex="-1">Related Resources <a class="header-anchor" href="#related-resources" aria-label="Permalink to &quot;Related Resources&quot;">​</a></h2><ul><li><a href="/api/graphql-api/shop/queries/get-customer-orders.html">Get Customer Orders</a> — Query all customer orders</li><li><a href="/api/graphql-api/shop/queries/get-customer-order.html">Get Customer Order</a> — Query a specific order before canceling</li><li><a href="/api/graphql-api/shop/mutations/reorder-customer-order.html">Reorder Customer Order</a> — Re-add items from a canceled order</li><li><a href="/api/graphql-api/shop/mutations/customer-login.html">Customer Login</a> — Obtain authentication token</li><li><a href="/api/graphql-api/shop/mutations/place-order.html">Place Order</a> — Create new orders</li></ul>`,72)]))}const u=a(t,[["render",l]]);export{k as __pageData,u as default};
